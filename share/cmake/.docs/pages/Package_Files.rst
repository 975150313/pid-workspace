Package files
*************

This page describe the files generated by PID for each package, i.e. what information the file holds and when it is generated during the package lifecycle.

.. _package reference file:

Reference file
--------------

A reference file is a PID specific cmake script file provided for any kind of deployment unit: native packages, external packages and frameworks.
It defines the meta information about the deployment unit, the most important being where to find it online.
Any reference file is located in `<workspace>/share/cmake/references`.

About names of references files:

 - for native packages the pattern name is Refer<package name>.cmake
 - for external packages the pattern name is ReferExternal<package name>.cmake
 - for frameworks the pattern name is ReferFramework<framework name>.cmake

As an example here is the reference file of package pid-rpath:

.. code-block:: cmake

  set(pid-rpath_MAIN_AUTHOR _Robin_Passama CACHE INTERNAL "")
  set(pid-rpath_MAIN_INSTITUTION _LIRMM CACHE INTERNAL "")
  set(pid-rpath_CONTACT_MAIL passama@lirmm.fr CACHE INTERNAL "")
  set(pid-rpath_FRAMEWORK pid CACHE INTERNAL "")
  set(pid-rpath_SITE_ROOT_PAGE  CACHE INTERNAL "")
  set(pid-rpath_PROJECT_PAGE https://gite.lirmm.fr/pid/pid-rpath CACHE INTERNAL "")
  set(pid-rpath_SITE_GIT_ADDRESS  CACHE INTERNAL "")
  set(pid-rpath_SITE_INTRODUCTION pid-rpath;is;a;package;providing;a;little;API;to;ease;the;management;of;runtime;resources;within;a;PID;workspace.;Runtime;resources;may;be;either;configuration;files,;executables;or;module;libraries.;Its;usage;is;completely;bound;to;the;use;of;PID;system. CACHE INTERNAL "")
  set(pid-rpath_AUTHORS_AND_INSTITUTIONS "_Robin_Passama(_LIRMM);_Benjamin_Navarro(_LIRMM)" CACHE INTERNAL "")
  set(pid-rpath_DESCRIPTION "Default package of PID, used to manage runtime path of executables" CACHE INTERNAL "")
  set(pid-rpath_YEARS 2015 CACHE INTERNAL "")
  set(pid-rpath_LICENSE CeCILL-C CACHE INTERNAL "")
  set(pid-rpath_ADDRESS git@gite.lirmm.fr:pid/pid-rpath.git CACHE INTERNAL "")
  set(pid-rpath_PUBLIC_ADDRESS https://gite.lirmm.fr/pid/pid-rpath.git CACHE INTERNAL "")
  set(pid-rpath_CATEGORIES "programming/resources_management" CACHE INTERNAL "")
  set(pid-rpath_REFERENCES  CACHE INTERNAL "")

There are meta informations about the package, for instance its license, its authors or the URLs of its documentation website and project site.
The most important informations are:

.. code-block:: cmake

  set(pid-rpath_ADDRESS git@gite.lirmm.fr:pid/pid-rpath.git CACHE INTERNAL "")
  set(pid-rpath_PUBLIC_ADDRESS https://gite.lirmm.fr/pid/pid-rpath.git CACHE INTERNAL "")

That define the private address of package git repository (the one used by developers to push/pull content) and its public counterpart (used by the other to clone the project via http if the repository has been made public).

.. code-block:: cmake

  set(pid-rpath_FRAMEWORK pid CACHE INTERNAL "")
  set(pid-rpath_SITE_ROOT_PAGE  CACHE INTERNAL "")
  set(pid-rpath_REFERENCES  CACHE INTERNAL "")

That define where to find binary archives for the package. For the `pid-rpath` package, the binary archives are provided undirectly through a framework (`pid-rpath_FRAMEWORK`).
If package belong to no framework a lone static site providing documentation and binary archives for that package can be used (`pid-rpath_SITE_ROOT_PAGE`).
Finally, when first two solution have not be chosen, it is also possible to directly define the url of the binary archives using `pid-rpath_REFERENCES`.

The reference file is generated by framework, native package or external package wrapper projects, from their CMake description.

It is used by PID mechanism whenever a deployment unit needs to be deployed in the local workspace on user workstation.

.. _package find file:

Find file
---------

A find file is a quite common type of file in CMake. These are the files managed by call to `find_package` CMake command, used to find on local filesystem the content of projects used by a CMake project (libraries, executable, compiler options, etc.) and check if their versions match the required ones.
These files are also used to populate CMake variables that will be used to configure the generated libraries and executables.

In PID, find files are used for same purpose either for native or external packages. The main difference is that they are generated respectively by packages and wrappers projects. They are
Any find file is located in `<workspace>/share/cmake/find`.

Here is an example of a find file for the native project `pid-rpath` (`Findpid-rpath.cmake`):

.. code-block:: cmake

  finding_Package(pid-rpath)

Quite simple all the job is done by the function `finding_Package(pid-rpath)` defined in PID.

For the external package `á»³aml-cpp` (file `Findyaml-cpp.cmake`):

.. code-block:: cmake

  set(yaml-cpp_PID_KNOWN_VERSION 0.5.1;0.5.3;0.6.2)
  finding_External_Package(yaml-cpp)

Same principle but the find file for an externa package also needs to provide known versions of the external package into PID, and compatibility between versions (here known versions of `yaml-cpp` are not compatible).
Indeed each external project follows its own versionning rules and no asumption can be made on compatibility between these versions.


The find file of a package is generated by native package or external package wrapper projects, from their CMake description, any time the project is configured. It is installed in the workspace after each build.


.. _package use file:

Use file
--------

A use file is a PID specific cmake script file provided for native and external packages. It contains the complete information about a given version of a package installed in the workspace, and built for a given target platform.
This information is used by other packages in order to configure their own build process.
Any use file is located in `share` subfolder of the package version folder in install tree.
The name of a use file follows the pattern: Use<package name>-<version>.cmake.


As a simple example here is the use file of package pid-rpath:

.. code-block:: cmake

  ######### declaration of package meta info that can be usefull for other packages ########
  set(pid-rpath_LICENSE CeCILL-C CACHE INTERNAL "")
  set(pid-rpath_ADDRESS git@gite.lirmm.fr:pid/pid-rpath.git CACHE INTERNAL "")
  set(pid-rpath_PUBLIC_ADDRESS https://gite.lirmm.fr/pid/pid-rpath.git CACHE INTERNAL "")
  set(pid-rpath_CATEGORIES programming/resources_management CACHE INTERNAL "")
  ######### declaration of package web site info ########
  set(pid-rpath_FRAMEWORK pid CACHE INTERNAL "")
  set(pid-rpath_PROJECT_PAGE https://gite.lirmm.fr/pid/pid-rpath CACHE INTERNAL "")
  set(pid-rpath_SITE_ROOT_PAGE  CACHE INTERNAL "")
  set(pid-rpath_SITE_GIT_ADDRESS  CACHE INTERNAL "")
  set(pid-rpath_SITE_INTRODUCTION pid-rpath;is;a;package;providing;a;little;API;to;ease;the;management;of;runtime;resources;within;a;PID;workspace.;Runtime;resources;may;be;either;configuration;files,;executables;or;module;libraries.;Its;usage;is;completely;bound;to;the;use;of;PID;system. CACHE INTERNAL "")
  ######### declaration of package development info ########
  set(pid-rpath_DEVELOPMENT_STATE release CACHE INTERNAL "")
  ######### declaration of package components ########
  set(pid-rpath_COMPONENTS rpathlib;rpath-example;rpath-crash-example;check-macros-ok;check-macros-ko CACHE INTERNAL "")
  set(pid-rpath_COMPONENTS_APPS rpath-example;rpath-crash-example;check-macros-ok;check-macros-ko CACHE INTERNAL "")
  set(pid-rpath_COMPONENTS_LIBS rpathlib CACHE INTERNAL "")
  set(pid-rpath_COMPONENTS_SCRIPTS  CACHE INTERNAL "")
  ####### internal specs of package components #######
  set(pid-rpath_rpathlib_TYPE SHARED CACHE INTERNAL "")
  set(pid-rpath_rpathlib_HEADER_DIR_NAME rpathlib CACHE INTERNAL "")
  set(pid-rpath_rpathlib_HEADERS pid/rpath_resolver.h;pid/rpath.h;pid/pid_path.h CACHE INTERNAL "")
  set(pid-rpath_rpath-example_TYPE EXAMPLE CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_TYPE EXAMPLE CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_TYPE TEST CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_TYPE TEST CACHE INTERNAL "")
  #### declaration of platform dependencies in Release mode ####
  set(pid-rpath_PLATFORM x86_64_linux_abi11 CACHE INTERNAL "")
  set(pid-rpath_PLATFORM_CONFIGURATIONS posix CACHE INTERNAL "")
  #### declaration of external package dependencies in Release mode ####
  set(pid-rpath_EXTERNAL_DEPENDENCIES boost CACHE INTERNAL "")
  set(pid-rpath_EXTERNAL_DEPENDENCY_boost_VERSION 1.55.0 CACHE INTERNAL "")
  set(pid-rpath_EXTERNAL_DEPENDENCY_boost_VERSION_EXACT TRUE CACHE INTERNAL "")
  set(pid-rpath_EXTERNAL_DEPENDENCY_boost_COMPONENTS  CACHE INTERNAL "")
  #### declaration of package dependencies in Release mode ####
  set(pid-rpath_DEPENDENCIES pid-benchmark-for-tests CACHE INTERNAL "")
  set(pid-rpath_DEPENDENCY_pid-benchmark-for-tests_VERSION 0.3 CACHE INTERNAL "")
  set(pid-rpath_DEPENDENCY_pid-benchmark-for-tests_VERSION_EXACT TRUE CACHE INTERNAL "")
  set(pid-rpath_DEPENDENCY_pid-benchmark-for-tests_COMPONENTS  CACHE INTERNAL "")
  #### declaration of components exported flags and binary in Release mode ####
  set(pid-rpath_rpathlib_BINARY_NAME librpathlib.so CACHE INTERNAL "")
  set(pid-rpath_rpathlib_INC_DIRS  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_OPTS  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_DEFS  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_LINKS  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_PRIVATE_LINKS <boost>/lib/libboost_system.so.1.55.0;<boost>/lib/libboost_filesystem.so.1.55.0 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_C_STANDARD 90 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_CXX_STANDARD 98 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_RUNTIME_RESOURCES  CACHE INTERNAL "")
  set(pid-rpath_rpath-example_BINARY_NAME rpath-example CACHE INTERNAL "")
  set(pid-rpath_rpath-example_RUNTIME_RESOURCES test-pid-rpath.txt;pid-rpath-test-dir CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_BINARY_NAME rpath-crash-example CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_RUNTIME_RESOURCES pid-rpath-test-dir CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_BINARY_NAME check-macros-ok CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_RUNTIME_RESOURCES test-pid-rpath.txt;pid-rpath-test-dir CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_BINARY_NAME check-macros-ko CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_RUNTIME_RESOURCES test-pid-rpath.txt;pid-rpath-test-dir CACHE INTERNAL "")
  #### declaration package internal component dependencies in Release mode ####
  set(pid-rpath_rpath-example_INTERNAL_DEPENDENCIES rpathlib CACHE INTERNAL "")
  set(pid-rpath_rpath-example_INTERNAL_EXPORT_rpathlib FALSE CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_INTERNAL_DEPENDENCIES rpathlib CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_INTERNAL_EXPORT_rpathlib FALSE CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_INTERNAL_DEPENDENCIES rpathlib CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_INTERNAL_EXPORT_rpathlib FALSE CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_INTERNAL_DEPENDENCIES rpathlib CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_INTERNAL_EXPORT_rpathlib FALSE CACHE INTERNAL "")
  #### declaration of component dependencies in Release mode ####
  set(pid-rpath_check-macros-ok_DEPENDENCIES pid-benchmark-for-tests CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_DEPENDENCY_pid-benchmark-for-tests_COMPONENTS pid-benchmark-sh CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_EXPORT_pid-benchmark-for-tests_pid-benchmark-sh FALSE CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_DEPENDENCIES pid-benchmark-for-tests CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_DEPENDENCY_pid-benchmark-for-tests_COMPONENTS pid-benchmark-sh CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_EXPORT_pid-benchmark-for-tests_pid-benchmark-sh FALSE CACHE INTERNAL "")
  #### declaration of platform dependencies in Debug mode ####
  set(pid-rpath_PLATFORM_DEBUG x86_64_linux_abi11 CACHE INTERNAL "")
  set(pid-rpath_PLATFORM_CONFIGURATIONS_DEBUG posix CACHE INTERNAL "")
  #### declaration of external package dependencies in Debug mode ####
  set(pid-rpath_EXTERNAL_DEPENDENCIES_DEBUG boost CACHE INTERNAL "")
  set(pid-rpath_EXTERNAL_DEPENDENCY_boost_VERSION_DEBUG 1.55.0 CACHE INTERNAL "")
  set(pid-rpath_EXTERNAL_DEPENDENCY_boost_VERSION_EXACT_DEBUG TRUE CACHE INTERNAL "")
  set(pid-rpath_EXTERNAL_DEPENDENCY_boost_COMPONENTS_DEBUG  CACHE INTERNAL "")
  #### declaration of package dependencies in Debug mode ####
  set(pid-rpath_DEPENDENCIES_DEBUG pid-benchmark-for-tests CACHE INTERNAL "")
  set(pid-rpath_DEPENDENCY_pid-benchmark-for-tests_VERSION_DEBUG 0.3 CACHE INTERNAL "")
  set(pid-rpath_DEPENDENCY_pid-benchmark-for-tests_VERSION_EXACT_DEBUG TRUE CACHE INTERNAL "")
  set(pid-rpath_DEPENDENCY_pid-benchmark-for-tests_COMPONENTS_DEBUG  CACHE INTERNAL "")
  #### declaration of components exported flags and binary in Debug mode ####
  set(pid-rpath_rpathlib_BINARY_NAME_DEBUG librpathlib-dbg.so CACHE INTERNAL "")
  set(pid-rpath_rpathlib_INC_DIRS_DEBUG  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_OPTS_DEBUG  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_DEFS_DEBUG  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_LINKS_DEBUG  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_PRIVATE_LINKS_DEBUG <boost>/lib/libboost_system.so.1.55.0;<boost>/lib/libboost_filesystem.so.1.55.0 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_C_STANDARD_DEBUG 90 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_CXX_STANDARD_DEBUG 98 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_RUNTIME_RESOURCES_DEBUG  CACHE INTERNAL "")
  set(pid-rpath_rpath-example_BINARY_NAME_DEBUG rpath-example-dbg CACHE INTERNAL "")
  set(pid-rpath_rpath-example_RUNTIME_RESOURCES_DEBUG test-pid-rpath.txt;pid-rpath-test-dir CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_BINARY_NAME_DEBUG rpath-crash-example-dbg CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_RUNTIME_RESOURCES_DEBUG pid-rpath-test-dir CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_BINARY_NAME_DEBUG check-macros-ok-dbg CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_RUNTIME_RESOURCES_DEBUG test-pid-rpath.txt;pid-rpath-test-dir CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_BINARY_NAME_DEBUG check-macros-ko-dbg CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_RUNTIME_RESOURCES_DEBUG test-pid-rpath.txt;pid-rpath-test-dir CACHE INTERNAL "")
  #### declaration package internal component dependencies in Debug mode ####
  set(pid-rpath_rpath-example_INTERNAL_DEPENDENCIES_DEBUG rpathlib CACHE INTERNAL "")
  set(pid-rpath_rpath-example_INTERNAL_EXPORT_rpathlib_DEBUG FALSE CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_INTERNAL_DEPENDENCIES_DEBUG rpathlib CACHE INTERNAL "")
  set(pid-rpath_rpath-crash-example_INTERNAL_EXPORT_rpathlib_DEBUG FALSE CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_INTERNAL_DEPENDENCIES_DEBUG rpathlib CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_INTERNAL_EXPORT_rpathlib_DEBUG FALSE CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_INTERNAL_DEPENDENCIES_DEBUG rpathlib CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_INTERNAL_EXPORT_rpathlib_DEBUG FALSE CACHE INTERNAL "")
  #### declaration of component dependencies in Debug mode ####
  set(pid-rpath_check-macros-ok_DEPENDENCIES_DEBUG pid-benchmark-for-tests CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_DEPENDENCY_pid-benchmark-for-tests_COMPONENTS_DEBUG pid-benchmark-sh CACHE INTERNAL "")
  set(pid-rpath_check-macros-ok_EXPORT_pid-benchmark-for-tests_pid-benchmark-sh_DEBUG FALSE CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_DEPENDENCIES_DEBUG pid-benchmark-for-tests CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_DEPENDENCY_pid-benchmark-for-tests_COMPONENTS_DEBUG pid-benchmark-sh CACHE INTERNAL "")
  set(pid-rpath_check-macros-ko_EXPORT_pid-benchmark-for-tests_pid-benchmark-sh_DEBUG FALSE CACHE INTERNAL "")

The use file describes most of informations for release and debug modes separately as sometimes there may have some little variations between the two modes.


The use file describes the platforms constraints applying to this version of the package for the target platform:

.. code-block:: cmake

  set(pid-rpath_PLATFORM x86_64_linux_abi11 CACHE INTERNAL "")
  set(pid-rpath_PLATFORM_CONFIGURATIONS posix CACHE INTERNAL "")

The target platform is here `x86_64_linux_abi11``and the only required configuration is `posix`.

The use file also describes package dependencies (either native or external) for the given version of the package. For instance the `pid-rpath` package depends on `boost` external package with exact version `1.55.0`:

.. code-block:: cmake

  set(pid-rpath_EXTERNAL_DEPENDENCIES boost CACHE INTERNAL "")
  set(pid-rpath_EXTERNAL_DEPENDENCY_boost_VERSION 1.55.0 CACHE INTERNAL "")
  set(pid-rpath_EXTERNAL_DEPENDENCY_boost_VERSION_EXACT TRUE CACHE INTERNAL "")

The use file also contains a full description of all components defined by the `pid-rpath` package, for instance the variables for the `rpathlib` library are:

.. code-block:: cmake

  set(pid-rpath_rpathlib_TYPE SHARED CACHE INTERNAL "")
  set(pid-rpath_rpathlib_HEADER_DIR_NAME rpathlib CACHE INTERNAL "")
  set(pid-rpath_rpathlib_HEADERS pid/rpath_resolver.h;pid/rpath.h;pid/pid_path.h CACHE INTERNAL "")
  set(pid-rpath_rpathlib_BINARY_NAME librpathlib.so CACHE INTERNAL "")
  set(pid-rpath_rpathlib_INC_DIRS  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_OPTS  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_DEFS  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_LINKS  CACHE INTERNAL "")
  set(pid-rpath_rpathlib_PRIVATE_LINKS <boost>/lib/libboost_system.so.1.55.0;<boost>/lib/libboost_filesystem.so.1.55.0 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_C_STANDARD 90 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_CXX_STANDARD 98 CACHE INTERNAL "")
  set(pid-rpath_rpathlib_RUNTIME_RESOURCES  CACHE INTERNAL "")

They define where to find its type, its headers, its binary name, the C++ language standard in use, etc. From these informations, other package can configure their own components to use the `rpathlib` library.


The find file of a package is generated by native package or external package wrapper projects, from their CMake description, any time the project is configured. It is installed in the package install tree, at the end of each build.
